<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

    <title>Cadastro de movimentação</title>
	<link rel="icon" href="https://imgs.search.brave.com/zy0sfkgKeppdWAXGyYDnopeaDcBoxZyy_1tEfu-gL8c/rs:fit:32:32:1:0/g:ce/aHR0cDovL2Zhdmlj/b25zLnNlYXJjaC5i/cmF2ZS5jb20vaWNv/bnMvN2Q5NDZhNTVl/NmM5YzdiNDc3ZDMw/NGVmYzExZmMxNjY4/NDQzZmVhYWVkODQ2/NTVhMmYyNTJjMGE5/MTcwNTYwMS93d3cu/aGFyYXNyb3NhbXlz/dGljYS5jb20uYnIv" type="image/x-icon">
	
    <style>
        body {
            font-family: "Asar", Sans-serif;
            background-color: #C0C0C0;
        }
        .form-container {
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
			margin-bottom: 10px;
            max-width: 900px;
            width: 100%;
            border-top: 4px solid #808080;
			border-bottom: 4px solid #808080;
        }

        h2 {
            font-size: 32px;
             color: #333333;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .watermark {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.5);
            pointer-events: none;
        }

        .form-row {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .saldo-info {
            font-size: 14px;
            color: #6c757d;
            line-height: 2.2;
        }

        .form-control {
            border-radius: 8px;
        }

        .btn {
            border-radius: 50px;
        }

		/* Personalização do botão primário */
		.btn-light {
		    background-color: #1b1e21; /* Cor de fundo personalizada */
		    color: white; /* Cor do texto do botão */
		    border: none; /* Remove borda */
		}

		/* Estilo do ícone dentro do botão */
		.btn-light i {
		    color: #ffffff; /* Cor branca para o ícone */
		}

		/* Efeito no hover */
		.btn-light:hover {
		    background-color: #cf8311; /* Cor de fundo diferente no hover */
		   
		}

		.btn-light:hover i {
		    color: #ffffff; /* Cor do ícone no hover */
		}

		/* Personalização do botão de sucesso */
		.btn-dark {
		    background-color: #cf8311; /* Cor de fundo personalizada */
		    color: white; /* Cor do texto do botão */
		    border: none; /* Remove borda */
		}

		/* Estilo dos ícones dentro do botão */
		.btn-dark i {
		    color: #ffffff; /* Cor branca para os ícones */
		}

		/* Efeito no hover */
		.btn-dark:hover {
		    background-color: #1b1e21; /* Cor de fundo diferente no hover */
		   
		}

		.btn-dark:hover i {
		    color:  #ffffff; /* Cor dos ícones no hover */
		}
        .btn-sm {
            font-size: 14px;
            padding: 10px 20px;
        }

        .btn i {
            margin-right: 8px;
        }

        .text-muted {
            color: #6c757d !important;
        }

		label {
		    display: inline-block;
		    margin-bottom: .5rem;
		    font-weight: 600;
		}

        .custom-divider {
            margin: 10px 0;
            border-top: 1px solid #e1e1e1;
        }
		.navbar {
		    position: relative;
		    display: -ms-flexbox;
		    display: flex;
		    -ms-flex-wrap: wrap;
		    flex-wrap: wrap;
		    -ms-flex-align: center;
		    align-items: center;
		    -ms-flex-pack: justify;
		    justify-content: space-between;
		    padding: .5rem 1rem;
		}
		/* Ajuste para o Navbar */ 
		.navbar {
		    font-size: 1rem; /* Define o tamanho da fonte */
			width: 100%;  /* Largura do Navbar */
		    height: 138.86px; /* Define a altura */
		    background-color: #000000C4; /* Define a cor de fundo com opacidade */
			border-style: solid;
		    border-width: 0 0 4px;
		    border-color: #fc0;
		}

		.navbar-nav .nav-item .nav-link {
		    font-size: 1.2rem; /* Define o tamanho da fonte dos itens do menu */
		    padding: 0.5rem 1rem; /* Ajusta o espaçamento dos itens */
		    font-family: "Asar", Sans-serif;
		    text-decoration: none; /* Remove o sublinhado dos links */
		    color: #000; /* Cor padrão dos links */
		    transition: color 0.3s ease; /* Suaviza a transição de cor */
		}

		.navbar-nav .nav-item .nav-link:hover {
		    color: #cf8311; /* Cor ao passar o mouse */
		}

		.navbar-toggler {
		    border: none;
		}

		.navbar-brand img {
		    width: 300px;
		    height: 100px; /* Ajuste o tamanho do logo */
		}

		.navbar-nav {
		    margin-left: auto; /* Alinha os itens à direita para centralizar */
		}

		.navbar-collapse {
		    justify-content: center; /* Centraliza o conteúdo do menu */
		}

		.navbar-dark .navbar-nav .nav-link {
		    color: #fff; /* Cor dos itens de navegação */
		}

		/* Ajuste no campo de pesquisa */
		.form-inline .form-control {
		    font-size: 1rem; /* Tamanho da fonte do campo de pesquisa */
		}

		.form-inline .btn {
		    font-size: 1rem; /* Tamanho da fonte do botão */
		}
		div.dt-container .dt-search input {
		    border: 1px solid #aaa;
		    border-radius: 50px;
		    padding: 5px;
		    background-color: transparent;
		    color: inherit;
		    margin-left: 3px;
		}
		.m-0 {
		    margin: 0 !important;
		    font-family: "Asar", Sans-serif;
		    color: #cf8311;
		}
		.custom-link {
		    color: rgb(15, 15, 15); /* Cor inicial */
		    font-size: 32px; /* Tamanho da fonte */
		    text-decoration: none; /* Remove o sublinhado do link */
		}

		.custom-link:hover {
		    color: #cf8311; /* Cor do texto ao passar o mouse */
		}
		.form-group {
		    margin-bottom: 9px;
		}
    </style>
</head>
<link href="https://fonts.googleapis.com/css2?family=Asar&display=swap" rel="stylesheet">
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
	<div class="container">
        <!-- Logo à esquerda -->
        <a class="navbar-brand" href="#">
            <img src="https://sp-ao.shortpixel.ai/client/to_webp,q_glossy,ret_img,w_519,h_175/https://www.harasrosamystica.com.br/wp-content/uploads/2021/07/Logo-HRM-site.png" class="d-inline-block align-top" alt="Logo">
        </a>

        <!-- Botão do menu responsivo -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#conteudoNavbarSuportado" aria-controls="conteudoNavbarSuportado" aria-expanded="false" aria-label="Alterna navegação">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Div vazia para centralizar o menu de navegação -->
        <div class="d-none d-lg-flex flex-grow-1"></div>

        <!-- Conteúdo centralizado -->
        <div class="collapse navbar-collapse justify-content-center flex-grow-0" id="conteudoNavbarSuportado">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="/administrativo">Ir para a página inicial <span class="sr-only">(página atual)</span></a>
                </li>
			<!--<li class="nav-item">
                    <a class="nav-link" href="#">Link</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Dropdown
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Ação</a>
                        <a class="dropdown-item" href="#">Outra ação</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Algo mais aqui</a>
                    </div>-->
                </li>
            </ul>
        </div>

        <!-- Campo de pesquisa à direita
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Pesquisar" aria-label="Pesquisar">
            <button class="btn btn-outline-light my-2 my-sm-0" type="submit">Pesquisar</button>
        </form>-->
    </div>
</nav>

<!-- Main Content -->
<div class="container d-flex justify-content-center align-items-center">
    <div class="form-container" style="width: 100%; max-width: 900px;">
        <form action="/salvarMovimentacao" th:object="${movimentacao}" method="POST">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <a href="/administrativo" class="custom-link">
                    <i class="fa-regular fa-circle-left"></i> 
                </a>
                <h2 class="m-0 text-center flex-grow-1">Cadastro de Movimentação de Sêmen</h2>
                <div style="width: 100px;"></div> <!-- Espaçador para alinhamento -->
            </div>
            <div class="custom-divider"></div>

            <!-- Garanhão and Quantidade Inputs -->
			<div class="form-row">
			    <div class="col-12 col-md-6">
			        <label for="garanhaoSelect" class="label-info">Selecione o Garanhão</label>
			        <select id="garanhaoSelect" th:field="*{garanhao}" class="form-control" required>
			            <option value="">Escolha um Garanhão</option>
			            <option th:each="gar : ${listarGaranhoes}" th:value="${gar.id_garanhao}" th:text="${gar.nome_garanhao}"></option>
			        </select>
			    </div>
			    <div class="col-12 col-md-6">
			        <label for="destino" class="label-info">Destino</label>
			        <div id="destino" class="form-control">
			            <label>
			                <input required type="radio" name="destino" value="venda" onclick="mostrarCampoAdicional()"> Venda
			            </label>
			            <label>
			                <input required type="radio" name="destino" value="uso_interno" onclick="mostrarCampoAdicional()"> Uso Interno
			            </label>
			            <label>
			                <input required type="radio" name="destino" value="transferencia" onclick="mostrarCampoAdicional()"> Transferência
			            </label>
			        </div>
			    </div>
			</div>

			<!-- Botijão, Data da Movimentação Inputs -->
			<div class="form-row">
			    <div class="col-12 col-md-6">
			        <label for="botijao" class="label-info">Número do Botijão</label>
			        <input type="text" id="botijao" th:field="*{botijao}" class="form-control" readonly/>
			    </div>

			    <div class="col-12 col-md-6">
			        <div>
			            <label for="info-adicional" class="label-info">Informação Adicional</label>
			            <input required type="text" th:field="*{endereco}" id="info-adicional" class="form-control" placeholder="Preencha as informações">
			        </div>
			    </div>
			</div>

			<!-- Nome do Profissional and Escolha de Profissional -->
			<div class="form-row">
			    <div class="col-12 col-md-6">
			        <label for="caneca" class="label-info">Número da Caneca</label>
			        <input type="text" id="caneca" th:field="*{caneca}" class="form-control" readonly/>
			    </div>

			    <!-- Escolha do Profissional -->
			    <div class="col-12 col-md-6"> 
			        <label for="profissional" class="label-info">Escolha um Profissional</label>
			        <div id="profissional" required class="form-control">
			            <label>
			                <input required type="radio" name="profissional" value="Motoboy" onclick="atualizarCamposProfissional()"> Motoboy
			            </label>
			            <label>
			                <input required type="radio" name="profissional" value="Veterinário" onclick="atualizarCamposProfissional()"> Veterinário
			            </label>
			        </div>
			    </div>
			</div>

			<!-- Caneca Input -->
			<div class="form-row">
			    <div class="col-12 col-md-6">
			        <label for="cor_palheta" class="label-info">Cor da Palheta</label>
			        <input type="text" id="cor_palheta" th:field="*{cor_palheta}" class="form-control" readonly/>
			    </div>

			    <div class="col-12 col-md-6"> 
			        <label for="nome_profissional" class="label-info">Nome do Profissional</label>
			        <input type="text" required id="nome_profissional" th:field="*{nome_profissional}" class="form-control" />
			    </div>
			</div>

			<!-- Quantidade de Palhetas -->
			<div class="form-row">
			    <div class="col-12 col-md-6">
			        <div class="form-group d-flex align-items-center">
			            <label for="quantidade" class="label-info mb-0">Quantidade de Palhetas</label>
			            <div id="saldo-info" style="margin-left: 131px; font-size: 13px">
			                Restam <span required id="saldo-atual-palhetas">0</span> palhetas
			            </div>
			        </div>
			        <input type="number" required id="quantidade" th:field="*{quantidade}" class="form-control"/>
			    </div>
				
				<div class="col-12 col-md-6">
			        <label for="identificador_profissional" class="label-info">Identificador do Profissional</label>
			        <input type="text" required id="identificador_profissional" th:field="*{identificador_profissional}" class="form-control" />
			    </div>			
			</div>
			
			<div class="form-row">
				<div class="col-12 col-md-6">
			        <label for="data_movimentacao" class="label-info">Data da Movimentação</label>
			        <input type="text" id="data_movimentacao" th:field="*{data_movimentacao}" readonly="true" class="form-control"/>
			    </div>
			</div>
            
            <div class="custom-divider"></div>

            <div class="d-flex justify-content-between mt-3">
                
                <a href="/administrativo/movimentacoes/listar" class="btn btn-light btn-sm text-white">
                    <i class="fa-solid fa-bars-staggered"></i> Lista
                </a>
                <button type="submit" class="btn btn-dark btn-sm">
                    <i class="fa-solid fa-plus"></i> Cadastrar Movimentação
                </button>
            </div>
			
        </form>
    </div>
</div>

    <div class="watermark">LucasSales@2024</div>

    <!-- Scripts JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script>
	$(document).ready(function() {
        // Inicializa o Select2 para o campo de seleção de garanhão
        $('#garanhaoSelect').select2();

        // Evento de alteração do campo "Garanhão"
        $('#garanhaoSelect').on('change', function() {
            var idGaranhao = $(this).val();

            // Verifica se um garanhão foi selecionado
            if (idGaranhao) {
                // Faz uma requisição para obter os dados do garanhão selecionado
                $.ajax({
                    url: "/administrativo/garanhoes/dados/" + idGaranhao, // URL para obter os dados do garanhão
                    method: "GET",
                    success: function(data) {
                        // Preenche os campos com os dados retornados
                        $("#botijao").val(data.botijao); // Preenche o campo Botijão
                        $("#caneca").val(data.caneca);   // Preenche o campo Caneca
                        $("#cor_palheta").val(data.cor_palheta); // Preenche o campo Cor da Palheta
                        $("#saldo-atual-palhetas").text(data.saldo_atual_palhetas); // Atualiza o saldo restante
                        $("#quantidade").attr('max', data.saldo_atual_palhetas); // Define o máximo de palhetas baseado no saldo
                    }
                });
            } else {
                // Limpa os campos se nenhum garanhão for selecionado
                $("#botijao, #caneca, #cor_palheta").val("");
                $("#saldo-atual-palhetas").text("0");
                $("#quantidade").attr('max', 0);
            }
        });
    });
	const quantidadeInput = document.getElementById('quantidade');
	  const saldoAtualSpan = document.getElementById('saldo-atual-palhetas');

	  // Validação para impedir valores negativos
	  quantidadeInput.addEventListener('input', (event) => {
	      const valorDigitado = parseInt(event.target.value, 10) || 0; // Garantir valor numérico válido

	      if (valorDigitado < 0) { // Não aceita valores menores que 1
	          event.target.value = 0; // Ajusta automaticamente para 1
	          alert('O valor não pode ser menor que 1.');
	      }
	  });

	  // Atualiza o valor máximo permitido no campo
	  function atualizarMaximo() {
	      const saldoAtual = parseInt(saldoAtualSpan.textContent, 10);
	      quantidadeInput.max = saldoAtual > 0 ? saldoAtual : 1; // Garante que o máximo seja sempre válido
	  }

	  // Atualizar limite ao carregar a página ou sempre que necessário
	  atualizarMaximo();


	    // Função para mostrar o campo adicional de acordo com o destino
	    function mostrarCampoAdicional() {
	        const destino = document.querySelector('input[name="destino"]:checked').value;
	        const campoAdicional = document.getElementById("campo-adicional");

	        // Exibe o campo adicional para qualquer destino selecionado
	        if (destino === "venda" || destino === "uso_interno" || destino === "transferencia") {
	            campoAdicional.style.display = "block"; // Mostra o campo adicional
	        } else {
	            campoAdicional.style.display = "none"; // Oculta o campo adicional
	        }
	    }
		$(document).ready(function() {
		    // Atualiza os campos quando o tipo de profissional for alterado
		    function atualizarCamposProfissional() {
		        const profissional = document.querySelector('input[name="profissional"]:checked').value;
		        const nomeProfissional = document.getElementById("nome_profissional");
		        const identificadorProfissional = document.getElementById("identificador_profissional");
				// Exibe os campos e atualiza os placeholders e máscaras conforme o tipo de profissional selecionado
				if (profissional === "Veterinário") {
				    nomeProfissional.placeholder = "Nome do Veterinário";
				    identificadorProfissional.placeholder = "CRM do Veterinário";
				    
				    // Ajusta o máximo de caracteres para 7 (2 letras + 5 ou 6 números)
				    identificadorProfissional.setAttribute('maxlength', '7'); 
				    
				    // Ajusta o padrão de validação para aceitar o formato de 2 letras seguidas de 5 ou 6 números
				    identificadorProfissional.setAttribute('pattern', '[A-Za-z]{2}-[0-9]{5,6}');
				    identificadorProfissional.title = "Digite o CRM do Veterinário";
				    
				    // Limpa o campo caso a escolha mude
				    identificadorProfissional.value = "";
				    
				    // Remove qualquer máscara anterior
				    $('#identificador_profissional').unmask();
				    
				    // Aplica a máscara de CRM (duas letras seguidas de números)
				    $('#identificador_profissional').mask('AA-000000', {
				        translation: {
				            'A': {
				                pattern: /[A-Za-z]/, // Aceita letras (maiúsculas ou minúsculas)
				                optional: false
				            }
				        }
				    });
		        } else if (profissional === "Motoboy") {
		            nomeProfissional.placeholder = "Nome do Motoboy";
		            identificadorProfissional.placeholder = "CPF do Motoboy";
		            // Máscara para CPF com pontuação (ex: 123.456.789-00)
		            identificadorProfissional.setAttribute('maxlength', '14'); // 14 caracteres com a máscara
		            identificadorProfissional.setAttribute('pattern', '[0-9]{3}\\.[0-9]{3}\\.[0-9]{3}-[0-9]{2}'); // Atualizado para incluir pontos e hífen
		            identificadorProfissional.title = "Digite o CPF do Motoboy";
		            
		            // Limpa o campo caso a escolha mude
		            identificadorProfissional.value = "";
		            // Remove qualquer máscara anterior
		            $('#identificador_profissional').unmask();
		            // Aplica a máscara de CPF com pontuação
		            $('#identificador_profissional').mask('000.000.000-00', { reverse: true });
		        } else {
		            nomeProfissional.placeholder = "";
		            identificadorProfissional.placeholder = "";
		            identificadorProfissional.value = ""; // Limpa o campo se nada for selecionado
		            // Remove a máscara
		            $('#identificador_profissional').unmask();
		        }
		    }

		    // Adiciona a função de mudança de seleção ao clicar nos botões de escolha
		    $('input[name="profissional"]').on('change', atualizarCamposProfissional);

		    // Inicializa a máscara para quando a página carregar
		    atualizarCamposProfissional();
		});


	    // Função para atualizar a data e hora
	    function atualizarHorario() {
	        var now = new Date();
	        var dia = String(now.getDate()).padStart(2, '0');
	        var mes = String(now.getMonth() + 1).padStart(2, '0');
	        var ano = now.getFullYear();
	        var horas = String(now.getHours()).padStart(2, '0');
	        var minutos = String(now.getMinutes()).padStart(2, '0');

	        // Formata a data e hora como dd/MM/yyyy HH:mm:ss
	        var dataFormatada = dia + '/' + mes + '/' + ano + ' ' + horas + ':' + minutos;

	        // Atualiza o valor do campo de input e também mantém a vinculação com o modelo
	        document.getElementById('data_movimentacao').value = dataFormatada;
	    }

	    // Atualiza a data e hora a cada segundo
	    setInterval(atualizarHorario, 1000);

	    // Chama a função uma vez ao carregar para já preencher o campo com a hora atual
	    atualizarHorario();
    </script>
	
</body>

</html>
